# DuckyNet é¡¹ç›®ç»“æ„è¯´æ˜

æœ¬æ–‡æ¡£è¯´æ˜ DuckyNet é¡¹ç›®çš„å®Œæ•´æ–‡ä»¶ç»“æ„å’Œç»„ç»‡æ–¹å¼ã€‚

---

## ğŸ“ å®Œæ•´é¡¹ç›®ç»“æ„

```
DuckyNet/
â”‚
â”œâ”€â”€ Client/                              # å®¢æˆ·ç«¯ä»£ç 
â”‚   â”œâ”€â”€ ConsoleModule.cs                # æ§åˆ¶å°æ¨¡å—
â”‚   â”œâ”€â”€ LocalPlayer.cs                  # æœ¬åœ°ç©å®¶ç®¡ç†
â”‚   â”œâ”€â”€ ModBehaviour.cs                 # Mod è¡Œä¸ºåŸºç±»
â”‚   â”œâ”€â”€ DuckyNetClient.csproj          # å®¢æˆ·ç«¯é¡¹ç›®æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ Core/                           # æ ¸å¿ƒåŠŸèƒ½
â”‚   â”‚   â”œâ”€â”€ AvatarManager.cs           # å¤´åƒç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ GameContext.cs             # æ¸¸æˆä¸Šä¸‹æ–‡ï¼ˆæœåŠ¡å®šä½å™¨ï¼‰
â”‚   â”‚   â”œâ”€â”€ InputManager.cs            # è¾“å…¥ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ UIManager.cs               # UI ç®¡ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ RPC/                            # RPC é€šä¿¡
â”‚   â”‚   â””â”€â”€ RpcClient.cs               # RPC å®¢æˆ·ç«¯
â”‚   â”‚
â”‚   â”œâ”€â”€ Services/                       # å®¢æˆ·ç«¯æœåŠ¡å®ç°
â”‚   â”‚   â”œâ”€â”€ PlayerClientServiceImpl.cs # ç©å®¶å®¢æˆ·ç«¯æœåŠ¡
â”‚   â”‚   â””â”€â”€ RoomClientServiceImpl.cs   # æˆ¿é—´å®¢æˆ·ç«¯æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ UI/                             # UI ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ DebugWindow.cs             # â­ æ¨¡å—åŒ–è°ƒè¯•çª—å£ï¼ˆä¸»çª—å£ï¼‰
â”‚   â”‚   â”œâ”€â”€ ChatWindow.cs              # èŠå¤©çª—å£
â”‚   â”‚   â”œâ”€â”€ LobbyPage.cs               # å¤§å…é¡µé¢
â”‚   â”‚   â”œâ”€â”€ MainMenuWindow.cs          # ä¸»èœå•çª—å£
â”‚   â”‚   â”œâ”€â”€ PlayerListWindow.cs        # ç©å®¶åˆ—è¡¨çª—å£
â”‚   â”‚   â””â”€â”€ RoomPage.cs                # æˆ¿é—´é¡µé¢
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ Debug/                      # â­ è°ƒè¯•æ¨¡å—ç³»ç»Ÿ
â”‚   â”‚       â”œâ”€â”€ IDebugModule.cs        # æ¨¡å—æ¥å£
â”‚   â”‚       â”œâ”€â”€ DebugModuleBase.cs     # æ¨¡å—åŸºç±»
â”‚   â”‚       â”œâ”€â”€ DebugModuleAttribute.cs# æ¨¡å—ç‰¹æ€§
â”‚   â”‚       â”œâ”€â”€ DebugModuleManager.cs  # æ¨¡å—ç®¡ç†å™¨
â”‚   â”‚       â”‚
â”‚   â”‚       â””â”€â”€ Modules/                # â­ è°ƒè¯•æ¨¡å—æ–‡ä»¶å¤¹
â”‚   â”‚           â”œâ”€â”€ PlayerSpawnModule.cs    # ç©å®¶ç”Ÿæˆæ¨¡å—
â”‚   â”‚           â”œâ”€â”€ NetworkTestModule.cs    # ç½‘ç»œæµ‹è¯•æ¨¡å—
â”‚   â”‚           â”œâ”€â”€ SystemInfoModule.cs     # ç³»ç»Ÿä¿¡æ¯æ¨¡å—
â”‚   â”‚           â”œâ”€â”€ GameStateModule.cs      # æ¸¸æˆçŠ¶æ€æ¨¡å—
â”‚   â”‚           â””â”€â”€ [ä½ çš„è‡ªå®šä¹‰æ¨¡å—].cs     # æ·»åŠ æ›´å¤šæ¨¡å—...
â”‚   â”‚
â”‚   â””â”€â”€ res/                            # å®¢æˆ·ç«¯èµ„æº
â”‚       â”œâ”€â”€ 0Harmony.dll               # Harmony è¡¥ä¸åº“
â”‚       â”œâ”€â”€ DuckyNet.Client.dll        # å®¢æˆ·ç«¯ DLL
â”‚       â”œâ”€â”€ DuckyNet.Shared.dll        # å…±äº« DLL
â”‚       â”œâ”€â”€ LiteNetLib.dll             # ç½‘ç»œåº“
â”‚       â”œâ”€â”€ NetSerializer.dll          # åºåˆ—åŒ–åº“
â”‚       â”œâ”€â”€ info.ini                   # æ¨¡ç»„ä¿¡æ¯
â”‚       â””â”€â”€ preview.png                # é¢„è§ˆå›¾
â”‚
â”œâ”€â”€ Server/                             # æœåŠ¡å™¨ä»£ç 
â”‚   â”œâ”€â”€ Program.cs                     # æœåŠ¡å™¨å…¥å£
â”‚   â”œâ”€â”€ DuckyNetServer.csproj         # æœåŠ¡å™¨é¡¹ç›®æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ Managers/                      # æœåŠ¡å™¨ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ PlayerManager.cs          # ç©å®¶ç®¡ç†å™¨
â”‚   â”‚   â””â”€â”€ RoomManager.cs            # æˆ¿é—´ç®¡ç†å™¨
â”‚   â”‚
â”‚   â”œâ”€â”€ RPC/                           # RPC æœåŠ¡ç«¯
â”‚   â”‚   â”œâ”€â”€ RpcServer.cs              # RPC æœåŠ¡å™¨
â”‚   â”‚   â””â”€â”€ RpcServerExtensions.cs    # RPC æ‰©å±•æ–¹æ³•
â”‚   â”‚
â”‚   â””â”€â”€ Services/                      # æœåŠ¡å™¨æœåŠ¡å®ç°
â”‚       â”œâ”€â”€ PlayerServiceImpl.cs      # ç©å®¶æœåŠ¡å®ç°
â”‚       â””â”€â”€ RoomServiceImpl.cs        # æˆ¿é—´æœåŠ¡å®ç°
â”‚
â”œâ”€â”€ Shared/                            # å…±äº«ä»£ç 
â”‚   â”œâ”€â”€ DuckyNetShared.csproj        # å…±äº«é¡¹ç›®æ–‡ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ RPC/                           # RPC å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ IRpcInvoker.cs           # RPC è°ƒç”¨æ¥å£
â”‚   â”‚   â”œâ”€â”€ IRpcService.cs           # RPC æœåŠ¡æ¥å£
â”‚   â”‚   â”œâ”€â”€ MessageType.cs           # æ¶ˆæ¯ç±»å‹
â”‚   â”‚   â”œâ”€â”€ RpcAttribute.cs          # RPC ç‰¹æ€§
â”‚   â”‚   â”œâ”€â”€ RpcCallAttribute.cs      # RPC è°ƒç”¨ç‰¹æ€§
â”‚   â”‚   â”œâ”€â”€ RpcMessage.cs            # RPC æ¶ˆæ¯
â”‚   â”‚   â”œâ”€â”€ RpcParameter.cs          # RPC å‚æ•°
â”‚   â”‚   â”œâ”€â”€ RpcRegistry.cs           # RPC æ³¨å†Œè¡¨
â”‚   â”‚   â”œâ”€â”€ RpcRequest.cs            # RPC è¯·æ±‚
â”‚   â”‚   â”œâ”€â”€ RpcResponse.cs           # RPC å“åº”
â”‚   â”‚   â”œâ”€â”€ RpcResult.cs             # RPC ç»“æœ
â”‚   â”‚   â”œâ”€â”€ RpcSerializer.cs         # RPC åºåˆ—åŒ–å™¨
â”‚   â”‚   â””â”€â”€ RpcTarget.cs             # RPC ç›®æ ‡
â”‚   â”‚
â”‚   â”œâ”€â”€ Services/                      # æœåŠ¡æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ IPlayerService.cs        # ç©å®¶æœåŠ¡æ¥å£
â”‚   â”‚   â””â”€â”€ IRoomService.cs          # æˆ¿é—´æœåŠ¡æ¥å£
â”‚   â”‚
â”‚   â””â”€â”€ Generated/                     # è‡ªåŠ¨ç”Ÿæˆçš„ä»£ç 
â”‚       â”œâ”€â”€ PlayerClientService*.cs   # ç©å®¶å®¢æˆ·ç«¯ä»£ç†
â”‚       â”œâ”€â”€ PlayerService*.cs         # ç©å®¶æœåŠ¡ä»£ç†
â”‚       â”œâ”€â”€ RoomClientService*.cs     # æˆ¿é—´å®¢æˆ·ç«¯ä»£ç†
â”‚       â”œâ”€â”€ RoomService*.cs           # æˆ¿é—´æœåŠ¡ä»£ç†
â”‚       â””â”€â”€ RpcTypeRegistry.cs        # RPC ç±»å‹æ³¨å†Œè¡¨
â”‚
â”œâ”€â”€ Tools/                             # å·¥å…·
â”‚   â””â”€â”€ RpcCodeGen/                   # RPC ä»£ç ç”Ÿæˆå™¨
â”‚       â”œâ”€â”€ Program.cs                # ç”Ÿæˆå™¨ä¸»ç¨‹åº
â”‚       â””â”€â”€ RpcCodeGen.csproj        # é¡¹ç›®æ–‡ä»¶
â”‚
â”œâ”€â”€ docs/                              # ğŸ“š æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ ç©å®¶è§’è‰²åˆ›å»ºæŒ‡å—.md          # è§’è‰²åˆ›å»ºå®Œæ•´æŒ‡å—
â”‚   â”œâ”€â”€ è°ƒè¯•æ¨¡å—å¼€å‘æŒ‡å—.md          # æ¨¡å—åŒ–è°ƒè¯•ç³»ç»Ÿæ•™ç¨‹
â”‚   â””â”€â”€ é¡¹ç›®ç»“æ„è¯´æ˜.md              # æœ¬æ–‡æ¡£
â”‚
â”œâ”€â”€ DuckyNet.sln                       # Visual Studio è§£å†³æ–¹æ¡ˆ
â”œâ”€â”€ build.bat                          # æ„å»ºè„šæœ¬
â”œâ”€â”€ start_server.bat                   # å¯åŠ¨æœåŠ¡å™¨è„šæœ¬
â”œâ”€â”€ README.md                          # é¡¹ç›®è¯´æ˜
â””â”€â”€ LICENSE                            # è®¸å¯è¯æ–‡ä»¶
```

---

## ğŸ¯ æ ¸å¿ƒç³»ç»Ÿè¯´æ˜

### 1. æ¨¡å—åŒ–è°ƒè¯•ç³»ç»Ÿ â­

**ä½ç½®**: `Client/UI/Debug/`

**æ ¸å¿ƒæ–‡ä»¶**:
- `IDebugModule.cs` - å®šä¹‰æ¨¡å—æ¥å£
- `DebugModuleBase.cs` - æä¾›åŸºç¡€å®ç°
- `DebugModuleManager.cs` - ç®¡ç†æ‰€æœ‰æ¨¡å—
- `DebugWindow.cs` - ä¸»è°ƒè¯•çª—å£

**æ¨¡å—å­˜æ”¾**:
- `Modules/` - æ‰€æœ‰è°ƒè¯•æ¨¡å—
  - æ”¯æŒå­æ–‡ä»¶å¤¹ç»„ç»‡
  - è‡ªåŠ¨å‘ç°å’Œæ³¨å†Œ
  - çƒ­æ’æ‹”æ”¯æŒ

**ç‰¹ç‚¹**:
- âœ… è‡ªåŠ¨æ¨¡å—å‘ç°ï¼ˆåå°„ï¼‰
- âœ… åˆ†ç±»ç®¡ç†
- âœ… ä¼˜å…ˆçº§æ’åº
- âœ… ç”Ÿå‘½å‘¨æœŸç®¡ç†
- âœ… å¯ç”¨/ç¦ç”¨åˆ‡æ¢

### 2. RPC é€šä¿¡ç³»ç»Ÿ

**ä½ç½®**: `Shared/RPC/`

**å·¥ä½œæµç¨‹**:
```
å®¢æˆ·ç«¯è°ƒç”¨ â†’ RPC åºåˆ—åŒ– â†’ ç½‘ç»œä¼ è¾“ â†’ RPC ååºåˆ—åŒ– â†’ æœåŠ¡å™¨æ‰§è¡Œ
```

**ä»£ç ç”Ÿæˆ**:
- ä½¿ç”¨ `Tools/RpcCodeGen` è‡ªåŠ¨ç”Ÿæˆä»£ç†ä»£ç 
- ç”Ÿæˆçš„ä»£ç å­˜æ”¾åœ¨ `Shared/Generated/`

### 3. æœåŠ¡æ¶æ„

**å®¢æˆ·ç«¯æœåŠ¡** (`Client/Services/`):
- `PlayerClientServiceImpl.cs` - å¤„ç†æ¥è‡ªæœåŠ¡å™¨çš„ç©å®¶äº‹ä»¶
- `RoomClientServiceImpl.cs` - å¤„ç†æˆ¿é—´äº‹ä»¶

**æœåŠ¡å™¨æœåŠ¡** (`Server/Services/`):
- `PlayerServiceImpl.cs` - å¤„ç†ç©å®¶è¯·æ±‚
- `RoomServiceImpl.cs` - å¤„ç†æˆ¿é—´é€»è¾‘

**æœåŠ¡æ¥å£** (`Shared/Services/`):
- `IPlayerService.cs` - ç©å®¶æœåŠ¡å¥‘çº¦
- `IRoomService.cs` - æˆ¿é—´æœåŠ¡å¥‘çº¦

---

## ğŸ“¦ ä¾èµ–å…³ç³»

```
DuckyNet.Client.dll
  â”œâ”€â”€ ä¾èµ–: DuckyNet.Shared.dll
  â”œâ”€â”€ ä¾èµ–: LiteNetLib.dll
  â”œâ”€â”€ ä¾èµ–: 0Harmony.dll
  â””â”€â”€ ä¾èµ–: NetSerializer.dll

DuckyNet.Server.exe
  â”œâ”€â”€ ä¾èµ–: DuckyNet.Shared.dll
  â”œâ”€â”€ ä¾èµ–: LiteNetLib.dll
  â””â”€â”€ ä¾èµ–: NetSerializer.dll

DuckyNet.Shared.dll
  â””â”€â”€ ä¾èµ–: LiteNetLib.dll
```

---

## ğŸ”§ å¼€å‘å·¥ä½œæµ

### æ·»åŠ æ–°çš„è°ƒè¯•æ¨¡å—

1. åœ¨ `Client/UI/Debug/Modules/` åˆ›å»ºæ–°æ–‡ä»¶
2. ç»§æ‰¿ `DebugModuleBase`
3. æ·»åŠ  `[DebugModule]` ç‰¹æ€§
4. å®ç° `OnGUI()` æ–¹æ³•
5. **æ— éœ€æ³¨å†Œ** - è‡ªåŠ¨å‘ç°ï¼

### æ·»åŠ æ–°çš„ RPC æœåŠ¡

1. åœ¨ `Shared/Services/` å®šä¹‰æ¥å£
2. æ·»åŠ  `[RpcService]` ç‰¹æ€§
3. åœ¨æœåŠ¡å™¨å®ç° `Server/Services/`
4. åœ¨å®¢æˆ·ç«¯å®ç° `Client/Services/`
5. è¿è¡Œ `Tools/RpcCodeGen` ç”Ÿæˆä»£ç 

### æ„å»ºé¡¹ç›®

```bash
# Windows
build.bat

# æˆ–ä½¿ç”¨ Visual Studio
- æ‰“å¼€ DuckyNet.sln
- æ„å»ºè§£å†³æ–¹æ¡ˆ
```

---

## ğŸ“ æ–‡ä»¶å‘½åçº¦å®š

| ç±»å‹ | å‘½åè§„åˆ™ | ç¤ºä¾‹ |
|------|---------|------|
| **æ¨¡å—** | `XXXModule.cs` | `PlayerSpawnModule.cs` |
| **æœåŠ¡æ¥å£** | `IXXXService.cs` | `IPlayerService.cs` |
| **æœåŠ¡å®ç°** | `XXXServiceImpl.cs` | `PlayerServiceImpl.cs` |
| **ç®¡ç†å™¨** | `XXXManager.cs` | `PlayerManager.cs` |
| **çª—å£** | `XXXWindow.cs` | `DebugWindow.cs` |
| **é¡µé¢** | `XXXPage.cs` | `LobbyPage.cs` |

---

## ğŸ¨ ä»£ç ç»„ç»‡åŸåˆ™

### 1. å•ä¸€èŒè´£

æ¯ä¸ªæ–‡ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½ï¼š
- âœ… `PlayerSpawnModule.cs` - åªå¤„ç†ç©å®¶ç”Ÿæˆ
- âœ… `NetworkTestModule.cs` - åªå¤„ç†ç½‘ç»œæµ‹è¯•
- âŒ é¿å…å¤§å‹çš„"Utils"æˆ–"Helper"ç±»

### 2. åˆ†å±‚æ¶æ„

```
è¡¨ç¤ºå±‚ (UI)
    â†“
ä¸šåŠ¡é€»è¾‘å±‚ (Services)
    â†“
æ•°æ®è®¿é—®å±‚ (Managers)
    â†“
ç½‘ç»œé€šä¿¡å±‚ (RPC)
```

### 3. ä¾èµ–æ³¨å…¥

ä½¿ç”¨ `GameContext` ä½œä¸ºæœåŠ¡å®šä½å™¨ï¼š

```csharp
// æ³¨å†ŒæœåŠ¡
GameContext.Instance.RegisterRpcClient(rpcClient);

// è·å–æœåŠ¡
var rpcClient = GameContext.Instance.RpcClient;
```

---

## ğŸš€ å¿«é€Ÿå¯¼èˆª

### æƒ³è¦...

**åˆ›å»ºæ–°çš„è°ƒè¯•æ¨¡å—ï¼Ÿ**
â†’ æŸ¥çœ‹ `Client/UI/Debug/Modules/` å’Œ [è°ƒè¯•æ¨¡å—å¼€å‘æŒ‡å—](è°ƒè¯•æ¨¡å—å¼€å‘æŒ‡å—.md)

**åˆ›å»ºç©å®¶è§’è‰²ï¼Ÿ**
â†’ æŸ¥çœ‹ [ç©å®¶è§’è‰²åˆ›å»ºæŒ‡å—](ç©å®¶è§’è‰²åˆ›å»ºæŒ‡å—.md)

**æ·»åŠ æ–°çš„ RPC æ–¹æ³•ï¼Ÿ**
â†’ æŸ¥çœ‹ `Shared/Services/` ä¸­çš„æ¥å£å®šä¹‰

**ä¿®æ”¹ UIï¼Ÿ**
â†’ æŸ¥çœ‹ `Client/UI/` ç›®å½•

**è°ƒæ•´æœåŠ¡å™¨é€»è¾‘ï¼Ÿ**
â†’ æŸ¥çœ‹ `Server/Services/` å’Œ `Server/Managers/`

---

## ğŸ“Š é¡¹ç›®ç»Ÿè®¡

- **æ ¸å¿ƒæ¨¡å—**: 4 ä¸ªï¼ˆPlayerSpawn, NetworkTest, SystemInfo, GameStateï¼‰
- **RPC æœåŠ¡**: 2 ä¸ªï¼ˆPlayer, Roomï¼‰
- **UI çª—å£**: 6 ä¸ª
- **æ–‡æ¡£**: 3 ç¯‡

---

## ğŸ”„ ç‰ˆæœ¬å†å²

### v2.0 (å½“å‰)
- âœ… å®Œæ•´çš„æ¨¡å—åŒ–è°ƒè¯•ç³»ç»Ÿ
- âœ… è‡ªåŠ¨æ¨¡å—å‘ç°å’Œæ³¨å†Œ
- âœ… ç©å®¶è§’è‰²å®Œæ•´åˆ›å»ºå®ç°
- âœ… 4 ä¸ªå†…ç½®è°ƒè¯•æ¨¡å—
- âœ… å®Œæ•´æ–‡æ¡£ä½“ç³»

### v1.0
- åŸºç¡€ RPC é€šä¿¡æ¡†æ¶
- ç®€å•çš„è°ƒè¯•çª—å£

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [ç©å®¶è§’è‰²åˆ›å»ºæŒ‡å—](ç©å®¶è§’è‰²åˆ›å»ºæŒ‡å—.md) - è¯¦ç»†çš„è§’è‰²åˆ›å»ºæ•™ç¨‹
- [è°ƒè¯•æ¨¡å—å¼€å‘æŒ‡å—](è°ƒè¯•æ¨¡å—å¼€å‘æŒ‡å—.md) - æ¨¡å—åŒ–ç³»ç»Ÿå®Œæ•´è¯´æ˜
- [README.md](../README.md) - é¡¹ç›®ä»‹ç»å’Œå¿«é€Ÿå¼€å§‹

---

## ğŸ’¡ è´¡çŒ®æŒ‡å—

### æ·»åŠ æ–°åŠŸèƒ½

1. é€‰æ‹©åˆé€‚çš„ç›®å½•
2. éµå¾ªå‘½åçº¦å®š
3. ç¼–å†™æ¸…æ™°çš„æ³¨é‡Š
4. æ›´æ–°ç›¸å…³æ–‡æ¡£

### ä»£ç é£æ ¼

- ä½¿ç”¨ C# æ ‡å‡†å‘½åè§„èŒƒ
- æ·»åŠ  XML æ–‡æ¡£æ³¨é‡Š
- ä¿æŒä»£ç ç®€æ´æ¸…æ™°
- éµå¾ª SOLID åŸåˆ™

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/) åè®®å¼€æºã€‚

---

**æœ€åæ›´æ–°**: 2025-10-29

