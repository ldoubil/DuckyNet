# DuckyNet 服务器启动说明

## 快速启动

### 1. 首次启动（需要还原依赖）

```powershell
cd E:\git\DuckyNet\Server
dotnet restore
dotnet run
```

### 2. 后续启动

```powershell
cd E:\git\DuckyNet\Server
dotnet run
```

## 访问地址

启动成功后，会看到以下提示：

```
==================================
  Server is ready!
  RPC Server: Port 9050
  Web Admin: http://localhost:5000
  Press Ctrl+C to stop server
==================================
```

### 可访问的服务

1. **Web 管理后台**: http://localhost:5000
   - 查看服务器状态
   - 管理房间和玩家
   - 监控场景和 NPC

2. **Swagger API 文档**: http://localhost:5000/swagger
   - API 接口文档
   - 在线测试 API

3. **RPC 服务器**: 端口 9050
   - 游戏客户端连接端口

## Web 后台功能

### 总览面板
- 📊 实时统计数据
- 👥 在线玩家数
- 🏠 活跃房间数
- 🤖 NPC 总数

### 房间管理
- 查看所有房间
- 房间详细信息
- 房间内玩家列表

### 玩家管理
- 在线玩家列表
- 玩家位置信息
- 玩家所在场景

### 场景管理
- 活跃场景列表
- 场景内玩家和 NPC
- NPC 位置和血量

## 停止服务器

按 `Ctrl+C` 停止服务器

服务器会自动：
- 关闭所有连接
- 卸载插件
- 停止 Web 服务器
- 清理资源

## 新增依赖包

本次更新添加了以下 NuGet 包：
- Microsoft.AspNetCore.App
- Swashbuckle.AspNetCore (Swagger)

如果遇到依赖问题，请运行：
```powershell
dotnet clean
dotnet restore
```

## 目录结构变化

```
Server/
├── Web/                    # 新增：Web 后台
│   ├── Controllers/       # API 控制器
│   ├── wwwroot/           # 静态文件（HTML/CSS/JS）
│   └── WebServerStartup.cs
├── Program.cs             # 已更新：集成 Web 服务器
└── DuckyNetServer.csproj  # 已更新：添加依赖
```

## 常见问题

### Q: 端口 5000 被占用
A: 修改 `Program.cs` 第 96 行的端口号
```csharp
var webTask = _webApp.RunAsync("http://localhost:你的端口");
```

### Q: 无法访问 Web 界面
A: 检查防火墙设置，确保允许端口 5000

### Q: API 返回空数据
A: 确保有客户端连接到服务器

### Q: 编译错误
A: 运行 `dotnet restore` 重新还原依赖

## 下一步

1. 启动服务器
2. 打开浏览器访问 http://localhost:5000
3. 连接游戏客户端测试
4. 在 Web 后台查看实时数据

祝使用愉快！🦆

